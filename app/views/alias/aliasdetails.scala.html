@(currentDatabaseConnection: Environment.ConnectionName, domain: Domain, alias: Alias, relays: Option[(Option[Relay],Option[Relay])])(implicit errorMessages: List[ErrorMessage] = List.empty, currentUser: Option[ApplicationUser], featureToggles: FeatureToggleMap)

@import helper._

@relayRow(relay: Relay) = {
   <tr>
      <td @if(!relay.enabled){class="disabled"}>@relay.recipient</td>
      <td @if(!relay.enabled){class="disabled"}>@relay.status</td>
      <td>@relay.enabled</td>
      <td class="actions">
         @if(featureToggles.isEnabled("toggle")){
            @if(relay.enabled){
               @form(action=routes.RelayController.disableAliasRelay(currentDatabaseConnection,domain.name,alias.mail,relay.recipient), 'class -> "form-inline", 'role -> "form"){
                  <button type"submit" title="disable" class="btn btn-xs btn-warning">d</button>
               }
            } else {
               @form(action=routes.RelayController.enableAliasRelay(currentDatabaseConnection,domain.name,alias.mail,relay.recipient), 'class -> "form-inline", 'role -> "form"){
                  <button type"submit" title="enable" class="btn btn-xs btn-success">e</button>
               }
            }
            @if(featureToggles.isEnabled("remove") && !relay.enabled){
               @form(action=routes.RelayController.removeAliasRelay(currentDatabaseConnection,domain.name,alias.mail,relay.recipient), 'class -> "form-inline", 'role -> "form"){
                  <button type="submit" title="remove" class="btn btn-xs btn-danger">x</button>
               }
            }
         }
      </td>
   </tr>
}

@addCatchallRow() = {
   <tr>
      <td colspan="3">&nbsp;</td>
      <td class="actions">
         @if(featureToggles.isEnabled("add")){
            @form(action=routes.RelayController.addAliasRelay(currentDatabaseConnection,domain.name,alias.mail), 'class -> "form-inline", 'role -> "form"){
               <input type="hidden" name="recipient" value="@@@domain.name"/>
               <input type="hidden" name="status" value="OK"/>
               <button type="submit" title="add" class="btn btn-xs col-sm-5 col-xs-5 btn-success">add catchall relay</button>
            }
         }
      </td>
   </tr>
}

@addRelayRow() = {
   <tr>
      <td colspan="3">&nbsp;</td>
      <td class="actions">
         @if(featureToggles.isEnabled("add")){
            @form(action=routes.RelayController.addAliasRelay(currentDatabaseConnection,domain.name,alias.mail), 'class -> "form-inline", 'role -> "form"){
               <input type="hidden" name="recipient" value="@alias.mail"/>
               <input type="hidden" name="status" value="OK"/>
               <button type="submit" title="add" class="btn btn-xs col-sm-5 col-xs-5 btn-success">add alias relay</button>
            }
         }
      </td>
   </tr>
}

@main(Some("Alias"), Some(currentDatabaseConnection)) {

   <h3><a href="@routes.AliasController.alias(currentDatabaseConnection)">Alias</a></h3>

   <table class="table">
      <tbody>
         <tr>
            <th>mail</th>
            <td colspan="2">@alias.mail</td>
         </tr>
         <tr>
            <th>destination</th>
            <td colspan="2">@alias.destination</td>
         </tr>
         <tr>
            <th>enabled</th>
            <td colspan="2">@alias.enabled</td>
         </tr>
         <tr>
            <th>domain</th>
            <td colspan="2" @if(!domain.enabled){class="disabled"}><a href="@routes.DomainController.viewDomain(currentDatabaseConnection,domain.name)">@domain.name</a></td>
         </tr>
      </tbody>
   </table>

   @if(featureToggles.isEnabled("toggle")){
      <section>
         @if(alias.enabled){
            @form(action=routes.AliasController.disable(currentDatabaseConnection,domain.name,alias.mail, "aliasdetails"), 'class -> "form-inline", 'role -> "form"){
               <button type"submit" title="disable" class="btn btn-sm col-sm-2 col-xs-2 btn-warning">disable alias</button>
            }
         } else {
            @form(action=routes.AliasController.enable(currentDatabaseConnection,domain.name,alias.mail,"aliasdetails"), 'class -> "form-inline", 'role -> "form"){
            <button type"submit" title="enable" class="btn btn-sm col-sm-2 col-xs-2 btn-success">enable alias</button>
            }
         }
      </section>
   }

   @if(featureToggles.isEnabled("remove") && !alias.enabled){
      <section>
         @form(action=routes.AliasController.remove(currentDatabaseConnection,domain.name,alias.mail,"aliasdetails"), 'class -> "form-inline", 'role -> "form"){
            <button type="submit" title="remove" class="btn btn-sm col-sm-2 col-xs-2 btn-danger">remove alias</button>
         }
      </section>
   }

   @for(relaysFound <- relays){

       <section>

         <h4>Relay maps</h4>

         <table class="table table-hover">
            <thead>
               <tr>
                  <th>recipient</th>
                  <th>status</th>
                  <th>enabled</th>
                  <th></th>
               </tr>
            </thead>
            <tbody>
               @relaysFound match {
                  case (None,None) => {
                     @addCatchallRow()
                     @addRelayRow()
                  }
                  case (None,Some(relay)) => {
                     @relayRow(relay)
                     @if(!relay.enabled){
                        @addCatchallRow()
                     }
                  }
                  case (Some(catchall),None) => {
                     @relayRow(catchall)
                     @if(!catchall.enabled){
                        @addRelayRow()
                     }
                  }
                  case (Some(catchall),Some(relay)) => {
                     @relayRow(catchall)
                     @relayRow(relay)
                  }
               }
            </tbody>
         </table>

      </section>
   }

}
